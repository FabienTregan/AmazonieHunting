<head>
    <script src="../lib/wideScreen.js"></script>

    <style>
        @import '../lib/wideScreen.css';
    
            body {
                background: blue;
                overflow: hidden;
            }
    
            #main {
                overflow: hidden;
                background-color: pink;
                perspective: 100px;
            }
    
            #main>* {
                position: absolute;
                background-size: cover;
                background-repeat: no-repeat;
                left: 0;
                top: 0;
            }
    
            #main>div.plan {
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
            }
    
        </style>
</head>

<body>

    <div id="main" class="wideScreen">
        <div id="plan5" class="plan" style="background-image: url('plan5.jpg'); z-index: 50;"></div>
        <div id="plan4" class="plan" style="background-image: url('plan4.png'); z-index: 60;"></div>
        <div id="plan3" class="plan" style="background-image: url('plan3.png'); z-index: 70;"></div>
        <div id="plan2" class="plan" style="background-image: url('plan2.png'); z-index: 80;"></div>
        <div id="plan1" class="plan" style="background-image: url('plan1.png'); z-index: 90;"></div>
        <img id="fleche" src="fleche.png" style="perspective: 100px; border: 1px solid tomato;">
    </div>

    <div style="text-align: center">
        <button type="button" onmouseenter="move(-3)" onmouseleave="move(0)">&lt;</button>
        <button type="button" onmouseenter="move(+3)" onmouseleave="move(0)">&gt;</button>
    </div>

    <script>

        var nbPlans = 5
        var position = -50
        var scrollSpeed = 0
        var flecheP = null
        var flecheV = null
        var flecheA = { x: 0, y: 0.05, z: 0 }

        function updateScreen() {
            updatePlansNodes(position)
            updatePlansNodes(position)
        }

        function updatePlansNodes(position) {

            for (var i = nbPlans; i > 0; i--) {

                var planId = "plan" + i
                var planNode = document.getElementById(planId)

                var focale = 60
                var zPlan = i * 10
                var distancePlan = (focale + zPlan) / 60

                var startX = (2500 - 1920) / 2 + position / distancePlan
                planNode.style.backgroundPositionX = (startX / 1920 * planNode.offsetWidth) + "px"
            }

            // dessin fleche
            var flecheNode = document.getElementById("fleche")
            flecheNode.style.top = "0"
            flecheNode.style.left = "0"
            flecheNode.style.zIndex = Math.round(150 - flecheP.z)

            flecheNode.style.transformOrigin = "left"
            var scale = main.offsetWidth / 1920

            var angle = Math.atan(flecheV.y / flecheV.x) / Math.PI * 180 * 0.9


            flecheNode.style.transform = ""
                + " scale(" + scale + ") "                   // mise à la taille de l'écran
                + " translate3d(1000px, 500px, 0px)"  // deplace la flèche dans son axe
                + " rotate3d(0, 1, 0, -45deg)"               // angle tire droite-gauche
                + " translate3d(" + flecheP.x + "px, " + flecheP.y + "px, " + flecheP.z + "px)"  // deplace la flèche dans son axe
                + " rotate3d(0, 0, 1, " + angle + "deg)"               // angle de la flèche haut-bas
                + " scale(0.25)"                              // echelle de la fleche
                + " translate3d(0%, 50%, 0px)"               // decallage pour avoir les coordonnées par rapport au milieu gauche

        }

        function updateCibleNode(position) {
        }

        function move(x) {
            scrollSpeed = x
        }

        function autoScroll(timestamp) {
            position += scrollSpeed

            if ((flecheP == null) || (flecheP.x < -1000)) {
                flecheP = { x: +250, y: -250, z: -500 }
                flecheV = { x: -5, y: -5, z: 0 }
            }

            flecheV.x += flecheA.x
            flecheV.y += flecheA.y
            flecheV.z += flecheA.z

            flecheP.x += flecheV.x
            flecheP.y += flecheV.y
            flecheP.z += flecheV.z

            updateScreen()
            requestAnimationFrame(autoScroll)
        }

        window.addEventListener('load', autoScroll)

    </script>

</body>