<head>
    <script src="../lib/wideScreen.js"></script>
    <script src="lib/gestures.js"></script>

    <style>
        @import '../lib/wideScreen.css';

        body {
            overflow: hidden;
        }

        #main {
            overflow: hidden;
        }

        .plan {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
        }

        .plan img {
            position: absolute;
            width: auto;
            height: 100%;
        }

        #bow {
            position: absolute;
            width: 100%;
            height: auto;
            bottom: 0px;
            left: -50%;
            margin-left: 50%;
        }
    </style>
</head>

<body>

    <div id="main" class="wideScreen">
        <div class="plan" style="z-index:60"><img id="plan5" src="plan5.jpg"></div>
        <div class="plan" style="z-index:70"><img id="plan4" src="plan4.png"></div>
        <div class="plan" style="z-index:80"><img id="plan3" src="plan3.png"></div>
        <div class="plan" style="z-index:90"><img id="plan2" src="plan2.png"></div>
        <div class="plan" style="z-index:100"><img id="plan1" src="plan1.png"></div>
        <img id="bow" src="bow.png" style="z-index: 110;">
    </div>

    <script>
        "use strict";

        var arrowAngle = 0;

        var nbPlans = 5
        var position = { x: 0, y: 0 }
        var moveSpeed = { x: 0, y: 0 }

        var plansSpeed = [1.333, 1.143, 1, 0.889, 0.800]

        function updateScreen() {
            updatePlans()
            requestAnimationFrame(updateScreen)
        }

        function updatePlans() {

            const MAX_POSITION = { x: 340, y: 340 }

            position.x += moveSpeed.x
            position.x = Math.min(position.x, MAX_POSITION.x)
            position.x = Math.max(position.x, -MAX_POSITION.x)

            position.y += moveSpeed.y
            position.y = Math.min(position.y, 0)
            position.y = Math.max(position.y, -MAX_POSITION.y)

            for (var i = nbPlans; i > 0; i--) {

                var planId = "plan" + i
                var planNode = document.getElementById(planId)

                var left = (1920 / 2 - 2880 / 2 + position.x * plansSpeed[i - 1]) / 1920 * 100
                planNode.style.left = left + "%"
            }

            var bowNode = document.getElementById("bow")
            var bottom = position.y / 1080 * 100
            var left = -position.x / 1920 * 100 - 50
            bowNode.style.bottom = bottom + "%"
            bowNode.style.left = left + "%"

        }

        var callbacks = {
            mouseMoved: function (coordinates) {
                const MAX_SPEED = 10

                var canvas = document.getElementById("main")
                moveSpeed = {
                    x: (1 - coordinates.x / canvas.offsetWidth * 2) * MAX_SPEED
                    , y: (1 - coordinates.y / canvas.offsetHeight * 2) * MAX_SPEED
                }
            },

            mouseClicked: function () {

            },

        }

        window.addEventListener('load', function () { addGesturesEventListeners("main", callbacks); updateScreen(); })

    </script>

</body>