<head>
    <script src="../lib/wideScreen.js"></script>

    <style>
        @import '../lib/wideScreen.css';

        body {
            background: blue;
            overflow: hidden;
        }

        #main {
            background-color: pink;
        }

        #main>* {
            position: absolute;
            background-size: cover;
            background-repeat: no-repeat;
            left: 0;
            top: 0;
        }

        #main>div.plan {
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
        }

    </style>
</head>

<body>

    <div id="main" class="wideScreen">
        <div id="plan4" class="plan" style="background-image: url('plan4.png'); z-index: 60;"></div>
        <div id="plan3" class="plan" style="background-image: url('plan3.png'); z-index: 70;"></div>
        <div id="plan2" class="plan" style="background-image: url('plan2.png'); z-index: 80;"></div>
        <div id="plan1" class="plan" style="background-image: url('plan1.png'); z-index: 90;"></div>
        <img id="fleche" src="fleche.png">
    </div>
    <br>

    <div style="text-align: center">
        <button type="button" onmouseenter="move(-1)" onmouseleave="move(0)">&lt;</button>
        <button type="button" onmouseenter="move(+1)" onmouseleave="move(0)">&gt;</button>
    </div>

    <script>

        var nbPlans = 4
        var position = -50
        var scrollSpeed = 0
        var flecheP = null
        var flecheV = null
        var flecheA = { x: 0, y: 2, z: 0 }

        function updateScreen() {
            updatePlansNodes(position)
            updatePlansNodes(position)
        }

        function updatePlansNodes(position) {
            for (var i = nbPlans; i > 0; i--) {

                var planId = "plan" + i
                var planNode = document.getElementById(planId)

                var distancePlan = (6 + i) * 10;

                var startX = (2500 - 1920) / 2 + position * 300 / distancePlan
                planNode.style.backgroundPositionX = (startX / 1920 * planNode.offsetWidth) + "px";
            }

            // dessin fleche
            var flecheNode = document.getElementById("fleche")
            var flecheWidth = flecheNode.naturalWidth
            var flecheHeight = fleche.naturalHeight
            var flecheApparentWidth = flecheWidth * 50 / flecheP.z
            var flecheApparentHeight = flecheHeight * 50 / flecheP.z
            flecheNode.style.left = (((1920 - flecheApparentWidth) / 2 + flecheP.x / flecheP.z) / 1920 * 100) + "%"
            flecheNode.style.top = (((1080 - flecheApparentHeight) / 2 + flecheP.y / flecheP.z) / 1080 * 100) + "%"
            flecheNode.style.width = flecheApparentWidth + "px"
            flecheNode.style.height = flecheApparentHeight + "px"
            flecheNode.style.zIndex = Math.round(150 - flecheP.z)
            flecheNode.style.transform = "rotate3d(1, 0, 0, " + flecheP.z + "deg)"
            console.log()
        }

        function updateCibleNode(position) {
        }

        function move(x) {
            scrollSpeed = x
        }

        function autoScroll(timestamp) {
            position += scrollSpeed

            if ((flecheP == null) || (flecheP.z > 120)) {
                flecheP = { x: 0, y: 0, z: 50 }
                flecheV = { x: 0, y: -150, z: 0.6 }
            }

            flecheV.x += flecheA.x
            flecheV.y += flecheA.y
            flecheV.z += flecheA.z

            flecheP.x += flecheV.x
            flecheP.y += flecheV.y
            flecheP.z += flecheV.z

            updateScreen()
            requestAnimationFrame(autoScroll)
        }

        window.addEventListener('load', autoScroll)

    </script>


</body>